# ëª¨ë°”ì¼ì•± ë°ì´í„° í”Œë¡œìš° & ì—°ê²° ê´€ê³„

> UNIQN Mobile Appì˜ í•µì‹¬ ì›Œí¬í”Œë¡œìš°ì™€ ë°ì´í„° ì—°ê²° ê´€ê³„ ë¬¸ì„œ

---

## 1. í•µì‹¬ ì›Œí¬í”Œë¡œìš° (5ë‹¨ê³„)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£ ì¸ì¦ í”Œë¡œìš°                                              â”‚
â”‚  ë¡œê·¸ì¸/íšŒì›ê°€ì… â†’ ë³¸ì¸ì¸ì¦(PASS/ì¹´ì¹´ì˜¤) â†’ í”„ë¡œí•„ ì™„ì„±        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£ êµ¬ì¸êµ¬ì§ í”Œë¡œìš° (ìŠ¤íƒœí”„)                                  â”‚
â”‚  ê³µê³  ê²€ìƒ‰/í•„í„° â†’ ìƒì„¸ ì¡°íšŒ â†’ ì§€ì›(Assignment v2.0) â†’ í™•ì •ëŒ€ê¸° â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£ ìŠ¤ì¼€ì¤„ & QR í”Œë¡œìš°                                       â”‚
â”‚  ë‚´ ìŠ¤ì¼€ì¤„ í™•ì¸ â†’ ë‹¹ì¼ QR ì¶œê·¼ â†’ ê·¼ë¬´ â†’ QR í‡´ê·¼ â†’ ì •ì‚° ëŒ€ê¸°   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£ êµ¬ì¸ì ê´€ë¦¬ í”Œë¡œìš°                                        â”‚
â”‚  ê³µê³  ìƒì„± â†’ ì§€ì›ì í™•ì¸ â†’ í™•ì •/ê±°ì ˆ â†’ ì¶œí‡´ê·¼ í™•ì¸ â†’ ì •ì‚° ì²˜ë¦¬ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£ ì•Œë¦¼ í”Œë¡œìš°                                               â”‚
â”‚  ì§€ì› ì•Œë¦¼ â†’ í™•ì •/ê±°ì ˆ ì•Œë¦¼ â†’ ê·¼ë¬´ ì „ë‚  ë¦¬ë§ˆì¸ë” â†’ ì •ì‚° ì™„ë£Œ   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 2. ì „ì²´ ë°ì´í„° ì—°ê²° ë‹¤ì´ì–´ê·¸ë¨

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           1ï¸âƒ£ ì¸ì¦ í”Œë¡œìš°                                     â”‚
â”‚                                                                             â”‚
â”‚   [users]                                                                   â”‚
â”‚   â”œâ”€ uid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”œâ”€ name                 â”‚                  â”‚                             â”‚
â”‚   â”œâ”€ role â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   â”œâ”€ identity.ci          â”‚                  â”‚                             â”‚
â”‚   â””â”€ fcmToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚                           â”‚                  â”‚                  â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚                  â”‚                  â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚                  â”‚
        â”‚                                      â”‚                  â”‚
        â–¼                                      â”‚                  â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       2ï¸âƒ£ êµ¬ì¸êµ¬ì§ í”Œë¡œìš°                                    â”‚
â”‚                                                                           â”‚
â”‚   [jobPostings]                      [applications]                       â”‚
â”‚   â”œâ”€ id â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤â”€ jobPostingId                      â”‚
â”‚   â”œâ”€ ownerId â—„â”€â”€â”€â”                   â”œâ”€ applicantId â—„â”€â”€â”€â”€ users.uid       â”‚
â”‚   â”œâ”€ dateSpecificRequirements[]      â”œâ”€ status                            â”‚
â”‚   â”œâ”€ roles[]                         â”œâ”€ assignments[] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚   â””â”€ status                          â””â”€ confirmationHistory[]   â”‚         â”‚
â”‚         â”‚                                    â”‚                  â”‚         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                    â”‚                  â”‚
          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â”‚
          â”‚         â”‚                                             â”‚
          â–¼         â–¼                                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       3ï¸âƒ£ ìŠ¤ì¼€ì¤„ & QR í”Œë¡œìš°                                 â”‚
â”‚                                                                           â”‚
â”‚   [workLogs]                              [eventQRCodes]                  â”‚
â”‚   â”œâ”€ applicationId â—„â”€â”€ applications.id    â”œâ”€ jobPostingId                 â”‚
â”‚   â”œâ”€ jobPostingId â—„â”€â”€â”€ jobPostings.id     â”œâ”€ generatedBy â—„â”€â”€ users.uid   â”‚
â”‚   â”œâ”€ staffId â—„â”€â”€â”€â”€â”€â”€â”€â”€ users.uid          â”œâ”€ qrData                       â”‚
â”‚   â”œâ”€ date                                 â””â”€ expiresAt                    â”‚
â”‚   â”œâ”€ actualStartTime / actualEndTime                                      â”‚
â”‚   â””â”€ settlementBreakdown â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚         â”‚                                         â”‚                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                                         â”‚
          â”‚         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚         â”‚
          â–¼         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       4ï¸âƒ£ êµ¬ì¸ì ê´€ë¦¬ í”Œë¡œìš°                                  â”‚
â”‚                                                                           â”‚
â”‚   êµ¬ì¸ìê°€ ê´€ë¦¬í•˜ëŠ” ë°ì´í„°:                                                  â”‚
â”‚   â”œâ”€ jobPostings (ownerId = ìì‹ )                                         â”‚
â”‚   â”œâ”€ applications (í•´ë‹¹ ê³µê³ ì˜ ì§€ì›ìë“¤)                                    â”‚
â”‚   â”œâ”€ workLogs (ì •ì‚° ì²˜ë¦¬)                                                  â”‚
â”‚   â””â”€ eventQRCodes (QR ë°œê¸‰)                                               â”‚
â”‚                                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚
          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       5ï¸âƒ£ ì•Œë¦¼ í”Œë¡œìš°                                        â”‚
â”‚                                                                           â”‚
â”‚   [notifications]                                                         â”‚
â”‚   â”œâ”€ userId â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ users.uid                                       â”‚
â”‚   â”œâ”€ type (application_received, confirmed, reminder, settlement)         â”‚
â”‚   â””â”€ data: {                                                              â”‚
â”‚        jobPostingId â—„â”€â”€â”€â”€ jobPostings.id                                  â”‚
â”‚        applicationId â—„â”€â”€â”€ applications.id                                 â”‚
â”‚        workLogId â—„â”€â”€â”€â”€â”€â”€â”€ workLogs.id                                     â”‚
â”‚      }                                                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. í•µì‹¬ ì—°ê²° í‚¤ (Foreign Keys)

| ì—°ê²° | From | To | ìš©ë„ |
|------|------|-----|------|
| **users.uid** | applications.applicantId | users | ì§€ì›ì ì •ë³´ ì¡°íšŒ |
| **users.uid** | workLogs.staffId | users | ê·¼ë¬´ì ì •ë³´ ì¡°íšŒ |
| **users.uid** | jobPostings.ownerId | users | ê³µê³  ì†Œìœ ì í™•ì¸ |
| **users.uid** | notifications.userId | users | ì•Œë¦¼ ëŒ€ìƒ |
| **jobPostings.id** | applications.jobPostingId | jobPostings | ì§€ì›í•œ ê³µê³  |
| **jobPostings.id** | workLogs.jobPostingId | jobPostings | ê·¼ë¬´í•œ ê³µê³  |
| **jobPostings.id** | eventQRCodes.jobPostingId | jobPostings | QR ëŒ€ìƒ ê³µê³  |
| **applications.id** | workLogs.applicationId | applications | í™•ì •ëœ ì§€ì›ì„œ |

---

## 4. í”Œë¡œìš°ë³„ ë°ì´í„° ì˜ì¡´ì„±

### 4.1 ì¸ì¦ â†’ êµ¬ì¸êµ¬ì§

```
users.uid â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ applications.applicantId
users.role â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ ê¶Œí•œ ì²´í¬ (employerë§Œ ê³µê³  ìƒì„± ê°€ëŠ¥)
users.name â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ applications.applicantName (ë³µì‚¬)
```

### 4.2 êµ¬ì¸êµ¬ì§ â†’ ìŠ¤ì¼€ì¤„

```
applications.id â”€â”€â”€â”€â†’ workLogs.applicationId (í™•ì • ì‹œ ìƒì„±)
applications.assignments[] â†’ workLogs ë‹¤ì¤‘ ìƒì„± (ë‚ ì§œë³„)
jobPostings.id â”€â”€â”€â”€â”€â†’ workLogs.jobPostingId
```

### 4.3 ìŠ¤ì¼€ì¤„ â†’ êµ¬ì¸ì

```
workLogs.actualStartTime â”€â”€â†’ settlementBreakdown ê³„ì‚°
workLogs.actualEndTime â”€â”€â”€â”€â†’ settlementBreakdown ê³„ì‚°
eventQRCodes.qrData â”€â”€â”€â”€â”€â”€â”€â†’ workLogs ì¶œí‡´ê·¼ ì—…ë°ì´íŠ¸
```

### 4.4 ì „ì²´ â†’ ì•Œë¦¼

```
applications.status ë³€ê²½ â”€â”€â†’ notifications ìƒì„±
workLogs.payrollStatus â”€â”€â”€â”€â†’ notifications ìƒì„± (ì •ì‚°ì™„ë£Œ)
users.fcmToken â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â†’ í‘¸ì‹œ ì•Œë¦¼ ì „ì†¡
```

---

## 5. íŠ¸ëœì­ì…˜ í•„ìˆ˜ ì—°ê²° ì§€ì 

### 5.1 ì§€ì› í™•ì • ì‹œ (3ê°œ ì»¬ë ‰ì…˜ ë™ì‹œ ìˆ˜ì •)

```typescript
runTransaction(async (tx) => {
  // 1. applications.status = 'confirmed'
  tx.update(applicationRef, {
    status: 'confirmed',
    confirmedAt: serverTimestamp()
  });

  // 2. jobPostings.filledPositions += 1
  tx.update(jobPostingRef, {
    filledPositions: increment(1)
  });

  // 3. workLogs ìƒˆë¡œ ìƒì„± (assignments[] ê¸°ë°˜)
  assignments.forEach(assignment => {
    tx.set(workLogRef, {
      applicationId,
      jobPostingId,
      staffId,
      date: assignment.date,
      status: 'scheduled'
    });
  });
});
```

### 5.2 QR ì²´í¬ì¸/ì•„ì›ƒ ì‹œ (2ê°œ ì»¬ë ‰ì…˜ ë™ì‹œ ìˆ˜ì •)

```typescript
runTransaction(async (tx) => {
  // 1. workLogs.actualStartTime/EndTime ì—…ë°ì´íŠ¸
  tx.update(workLogRef, {
    actualStartTime: serverTimestamp(),
    status: 'checked_in'
  });

  // 2. eventQRCodes.scanCount += 1
  tx.update(qrCodeRef, {
    scanCount: increment(1)
  });
});
```

### 5.3 ì •ì‚° ì²˜ë¦¬ ì‹œ (2ê°œ ì»¬ë ‰ì…˜ ë™ì‹œ ìˆ˜ì •)

```typescript
runTransaction(async (tx) => {
  // 1. workLogs.payrollStatus = 'completed'
  tx.update(workLogRef, {
    payrollStatus: 'completed',
    payrollDate: serverTimestamp()
  });

  // 2. notifications ìƒì„± (ì •ì‚°ì™„ë£Œ ì•Œë¦¼)
  tx.set(notificationRef, {
    userId: staffId,
    type: 'settlement_completed',
    data: { workLogId, amount }
  });
});
```

---

## 6. ë°ì´í„° ìƒì„± ì‹œì 

| ì‹œì  | ìƒì„±ë˜ëŠ” ë°ì´í„° | íŠ¸ë¦¬ê±° | ê´€ë ¨ í”Œë¡œìš° |
|------|---------------|--------|------------|
| íšŒì›ê°€ì… | `users` | ì¸ì¦ ì™„ë£Œ | 1ï¸âƒ£ ì¸ì¦ |
| ê³µê³  ë“±ë¡ | `jobPostings` | êµ¬ì¸ì ìƒì„± | 4ï¸âƒ£ êµ¬ì¸ì |
| ì§€ì› | `applications` | ìŠ¤íƒœí”„ ì§€ì› | 2ï¸âƒ£ êµ¬ì¸êµ¬ì§ |
| ì§€ì› í™•ì • | `workLogs` (1ê°œ ì´ìƒ) | êµ¬ì¸ì í™•ì • | 4ï¸âƒ£ êµ¬ì¸ì |
| QR ë°œê¸‰ | `eventQRCodes` | êµ¬ì¸ì ë°œê¸‰ | 3ï¸âƒ£ ìŠ¤ì¼€ì¤„ |
| QR ìŠ¤ìº” | `workLogs` ì—…ë°ì´íŠ¸ | ìŠ¤íƒœí”„ ì²´í¬ì¸/ì•„ì›ƒ | 3ï¸âƒ£ ìŠ¤ì¼€ì¤„ |
| ìƒíƒœ ë³€ê²½ | `notifications` | ìë™ ìƒì„± | 5ï¸âƒ£ ì•Œë¦¼ |

---

## 7. í•µì‹¬ ë°ì´í„° vs ë¯¸ì‚¬ìš© ë°ì´í„°

### 7.1 í•µì‹¬ ë°ì´í„° (ğŸ”´ í•„ìˆ˜)

| ì»¬ë ‰ì…˜ | í•µì‹¬ í•„ë“œ | ìš©ë„ |
|--------|----------|------|
| **users** | `uid`, `name`, `role`, `identity.ci`, `fcmToken` | ì‚¬ìš©ì ì‹ë³„, ê¶Œí•œ, ì¤‘ë³µê°€ì…ë°©ì§€, í‘¸ì‹œì•Œë¦¼ |
| **jobPostings** | `id`, `status`, `dateSpecificRequirements[]`, `roles[]`, `ownerId` | ê³µê³  ì¡°íšŒ/í•„í„°/ê´€ë¦¬ |
| **applications** | `id`, `applicantId`, `jobPostingId`, `status`, `assignments[]` | ì§€ì› ìƒíƒœ ê´€ë¦¬ |
| **workLogs** | `id`, `applicationId`, `staffId`, `jobPostingId`, `date`, `actualStartTime/EndTime`, `settlementBreakdown` | ì¶œí‡´ê·¼ ê¸°ë¡, ì •ì‚° |
| **eventQRCodes** | `id`, `jobPostingId`, `qrData`, `expiresAt`, `generatedBy` | QR ì¶œí‡´ê·¼ |
| **notifications** | `id`, `userId`, `type`, `isRead`, `data` | ì•Œë¦¼ |

### 7.2 ë¯¸ì‚¬ìš©/ë ˆê±°ì‹œ ë°ì´í„° (âš«)

| í•„ë“œ/ì»¬ë ‰ì…˜ | ìœ„ì¹˜ | ì´ìœ  |
|------------|------|------|
| `eventId` | applications | ë ˆê±°ì‹œ (â†’ `jobPostingId` ì‚¬ìš©) |
| `postId` | applications | ë ˆê±°ì‹œ (â†’ `jobPostingId` ì‚¬ìš©) |
| `workDate` (ë‹¨ì¼) | jobPostings | ë ˆê±°ì‹œ (â†’ `dateSpecificRequirements[]` ë°°ì—´ ì‚¬ìš©) |
| `timeSlot` (ë‹¨ì¼) | jobPostings | ë ˆê±°ì‹œ (â†’ ì‹œê°„ëŒ€ ë°°ì—´ ì‚¬ìš©) |
| `appliedRole` (ë‹¨ì¼) | applications | v1 í˜¸í™˜ì„± (â†’ `assignments[]` ì‚¬ìš©) |
| `appliedDate` (ë‹¨ì¼) | applications | v1 í˜¸í™˜ì„± (â†’ `assignments[].date` ì‚¬ìš©) |
| `staff` ì»¬ë ‰ì…˜ | Firestore | **ì™„ì „ ë¯¸ì‚¬ìš©** (ëª¨ë°”ì¼ì•±ì€ usersë§Œ ì‚¬ìš©) |
| `events` ì»¬ë ‰ì…˜ | Firestore | **ì™„ì „ ë¯¸ì‚¬ìš©** (â†’ jobPostingsë¡œ í†µí•©) |
| `tournaments` | ëª¨ë°”ì¼ì•± | Phase 2 ì´í›„ (í˜„ì¬ ë¯¸êµ¬í˜„) |
| `chips` ê´€ë ¨ | ëª¨ë°”ì¼ì•± | Phase 2 ì´í›„ (í˜„ì¬ ë¯¸êµ¬í˜„) |

---

## 8. í•µì‹¬ ì—°ê²° ì²´ì¸ ìš”ì•½

```
users.uid (ì¤‘ì‹¬ì¶•)
    â”‚
    â”œâ”€â”€â†’ jobPostings.ownerId (êµ¬ì¸ìë¡œì„œ)
    â”‚         â”‚
    â”‚         â””â”€â”€â†’ applications.jobPostingId (ê³µê³ ì— ëŒ€í•œ ì§€ì›)
    â”‚                   â”‚
    â”‚                   â””â”€â”€â†’ workLogs.applicationId (í™•ì •ëœ ì§€ì›ì˜ ê·¼ë¬´ê¸°ë¡)
    â”‚                             â”‚
    â”‚                             â””â”€â”€â†’ settlementBreakdown (ì •ì‚° ë°ì´í„°)
    â”‚
    â”œâ”€â”€â†’ applications.applicantId (ì§€ì›ìë¡œì„œ)
    â”‚
    â”œâ”€â”€â†’ workLogs.staffId (ê·¼ë¬´ìë¡œì„œ)
    â”‚
    â”œâ”€â”€â†’ eventQRCodes.generatedBy (QR ë°œê¸‰ìë¡œì„œ)
    â”‚
    â””â”€â”€â†’ notifications.userId (ì•Œë¦¼ ìˆ˜ì‹ ìë¡œì„œ)
```

**í•µì‹¬ í¬ì¸íŠ¸**:
- `users.uid`ê°€ ëª¨ë“  ë°ì´í„°ì˜ **ì¤‘ì‹¬ì¶•**
- `jobPostings.id`ê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì˜ **ì—°ê²° ê³ ë¦¬**
- `applications.id`ê°€ ì§€ì›-ê·¼ë¬´ ê°„ **ë¸Œë¦¿ì§€**

---

## 9. ìŠ¤íƒœí”„ vs êµ¬ì¸ì ë°ì´í„° ì ‘ê·¼ ë²”ìœ„

### ìŠ¤íƒœí”„ (staff)

```yaml
ì½ê¸° ê°€ëŠ¥:
  - jobPostings: ì „ì²´ (status = 'active')
  - applications: ë³¸ì¸ ê²ƒë§Œ (applicantId = uid)
  - workLogs: ë³¸ì¸ ê²ƒë§Œ (staffId = uid)
  - notifications: ë³¸ì¸ ê²ƒë§Œ (userId = uid)

ì“°ê¸° ê°€ëŠ¥:
  - applications: ìƒì„± (ì§€ì›), ì·¨ì†Œ ìš”ì²­
  - workLogs: QR ì²´í¬ì¸/ì•„ì›ƒë§Œ
```

### êµ¬ì¸ì (employer)

```yaml
ì½ê¸° ê°€ëŠ¥:
  - jobPostings: ë³¸ì¸ ê²ƒ (ownerId = uid)
  - applications: ë³¸ì¸ ê³µê³ ì— ëŒ€í•œ ê²ƒ (jobPostingId in myPostings)
  - workLogs: ë³¸ì¸ ê³µê³ ì— ëŒ€í•œ ê²ƒ (jobPostingId in myPostings)
  - notifications: ë³¸ì¸ ê²ƒë§Œ (userId = uid)

ì“°ê¸° ê°€ëŠ¥:
  - jobPostings: CRUD
  - applications: í™•ì •/ê±°ì ˆ
  - workLogs: ì •ì‚° ì²˜ë¦¬
  - eventQRCodes: ìƒì„±
```

---

## 10. ê´€ë ¨ ë¬¸ì„œ

- [01-architecture.md](./01-architecture.md) - ì•„í‚¤í…ì²˜ ì„¤ê³„
- [DATA_SCHEMA.md](../../docs/reference/DATA_SCHEMA.md) - Firestore ìŠ¤í‚¤ë§ˆ ìƒì„¸
- [09-error-handling.md](./09-error-handling.md) - ì—ëŸ¬ ì²˜ë¦¬ ì „ëµ
- [12-security.md](./12-security.md) - ë³´ì•ˆ ì„¤ê³„

---

*ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸: 2025-01-17*
