# 💎 UNIQN 하트/다이아 포인트 시스템 최종 정의

**최종 업데이트**: 2026년 2월 1일
**버전**: v2.0.0 (하트/다이아 포인트 시스템)
**상태**: ✅ **최종 확정**

> 📋 **상세 구현 계획**: [mobile-payment-plan.md](../../../mobile-payment-plan.md)

---

## 📋 목차

1. [포인트 시스템 개요](#-포인트-시스템-개요)
2. [포인트 시각 시스템](#-포인트-시각-시스템)
3. [다이아 충전 패키지](#-다이아-충전-패키지)
4. [하트 획득 방법](#-하트-획득-방법)
5. [공고 등록 가격표](#-공고-등록-가격표)
6. [어뷰징 방지 시스템](#-어뷰징-방지-시스템)
7. [법률 리스크 최소화](#-법률-리스크-최소화)
8. [만료 알림 시스템](#-만료-알림-시스템)
9. [핵심 장점 요약](#-핵심-장점-요약)
10. [구현 우선순위](#-구현-우선순위)

---

## 📊 포인트 시스템 개요

### 포인트 구조

| 포인트 타입 | 획득 방법 | 만료 | 가치 | 사용 우선순위 |
|------------|----------|------|------|--------------|
| 💖 **하트 (Heart)** | 무료 획득 | 90일 | 300원 | 먼저 사용 |
| 💎 **다이아 (Diamond)** | 유료 충전 | 없음 | 300원 | 나중에 사용 |

### 핵심 규칙

```
- 가치: 1 포인트 = 300원 (하트/다이아 동일)
- 사용 우선순위: 하트(만료 임박 순) → 다이아
- 하트 만료: 획득 후 90일
- 다이아 만료: 없음 (영구 보유)
```

### 무료 기간 정책

```typescript
const FREE_PERIOD_END = '2026-07-01'; // 출시 + 6개월

function isFreePeriod(): boolean {
  return new Date() < new Date(FREE_PERIOD_END);
}

// 무료 기간 중: 공고 등록 포인트 무료
// 유료화 이후: 정상 포인트 차감
```

---

## 🎨 포인트 시각 시스템

### 포인트 디자인 컨셉

#### 💖 하트 (Heart)

- **용도**: 무료 획득 포인트
- **색상**: 핑크/로즈 그라데이션
- **아이콘**: 하트 모양 (💖)
- **느낌**: "무료로 받은 보너스 포인트"
- **만료**: 획득 후 90일
- **우선순위**: 먼저 사용 (만료 임박 순)

#### 💎 다이아 (Diamond)

- **용도**: 유료 충전 포인트
- **색상**: 퍼플/블루 그라데이션
- **아이콘**: 다이아몬드 모양 (💎)
- **느낌**: "내가 구매한 프리미엄 포인트"
- **만료**: 없음 (영구 보유)
- **우선순위**: 나중에 사용

---

### UI 표시 방식

#### 헤더 잔액 표시
```
┌─────────────────────────────────┐
│  💖 12  💎 35                    │
└─────────────────────────────────┘
```

#### 상세 잔액 화면
```
┌─────────────────────────────────┐
│      💰 보유 포인트              │
├─────────────────────────────────┤
│                                  │
│      총 47 포인트               │
│      (₩14,100 상당)              │
│                                  │
│  💖 하트: 12개                  │
│     무료 획득 포인트             │
│     ⏰ 7일 내 3개 만료 예정      │
│                                  │
│  💎 다이아: 35개                │
│     유료 충전 포인트             │
│     ♾️ 만료 없음                │
│                                  │
├─────────────────────────────────┤
│  💡 사용 순서                   │
│  하트 먼저 → 다이아 나중에      │
│  (만료 임박한 하트 우선 사용)    │
└─────────────────────────────────┘
```

#### 공고 등록 화면
```
┌─────────────────────────────────┐
│  📢 공고 등록                    │
├─────────────────────────────────┤
│                                  │
│  공고 타입: 일반 (7일)          │
│  필요 포인트: 1💎               │
│                                  │
│  💳 현재 보유: 💖12 💎35        │
│                                  │
│  [등록하기]                     │
│                                  │
└─────────────────────────────────┘
```

#### 충전 패키지 화면
```
┌──────────────────────────────────┐
│  💎 다이아 충전                  │
├──────────────────────────────────┤
│                                   │
│  ┌─────────────────────┐        │
│  │  ₩1,000              │        │
│  │  💎 3개              │        │
│  │  [충전하기]          │        │
│  └─────────────────────┘        │
│                                   │
│  ┌─────────────────────┐        │
│  │  ₩3,000              │        │
│  │  💎 10개             │        │
│  │  [충전하기]          │        │
│  └─────────────────────┘        │
│                                   │
│  ┌─────────────────────┐  ⭐    │
│  │  ₩10,000             │        │
│  │  💎 35개 (+2 보너스)  │        │
│  │  +6% 보너스          │        │
│  │  [충전하기]          │        │
│  └─────────────────────┘        │
│                                   │
│  ┌─────────────────────┐  🏆    │
│  │  ₩30,000             │        │
│  │  💎 110개 (+10 보너스)│        │
│  │  +10% 보너스         │        │
│  │  [충전하기]          │        │
│  └─────────────────────┘        │
│                                   │
│  ┌─────────────────────┐  🔥    │
│  │  ₩50,000             │        │
│  │  💎 190개 (+23 보너스)│        │
│  │  +14% 보너스         │        │
│  │  [충전하기]          │        │
│  └─────────────────────┘        │
│                                   │
│  ┌─────────────────────┐  💎    │
│  │  ₩100,000            │        │
│  │  💎 400개 (+67 보너스)│        │
│  │  +20% 보너스 (최대)   │        │
│  │  [충전하기]          │        │
│  └─────────────────────┘        │
│                                   │
└──────────────────────────────────┘
```

---

## 💰 다이아 충전 패키지

### 패키지 정의

| 금액 | 기본 다이아 | 보너스 | 총 다이아 | 보너스율 |
|------|-----------|--------|----------|---------|
| ₩1,000 | 3 | - | 3 | - |
| ₩3,000 | 10 | - | 10 | - |
| ₩10,000 | 33 | +2 | 35 | +6% |
| ₩30,000 | 100 | +10 | 110 | +10% |
| ₩50,000 | 167 | +23 | 190 | +14% |
| ₩100,000 | 333 | +67 | 400 | +20% |

### 패키지 전략

#### ₩1,000 패키지 (3💎)
- **타겟**: 첫 충전 사용자, 소액 테스트
- **특징**: 진입 장벽 최소화
- **마케팅**: "커피 한 잔 가격으로 시작"

#### ₩3,000 패키지 (10💎)
- **타겟**: 가벼운 사용자
- **특징**: 일반 공고 10회 등록 가능
- **마케팅**: "한 달 기본 사용량"

#### ₩10,000 패키지 (35💎) ⭐ 인기
- **타겟**: 일반 구인자
- **특징**: +6% 보너스, 가성비 시작점
- **마케팅**: "가장 인기 있는 선택"

#### ₩30,000 패키지 (110💎) 🏆 추천
- **타겟**: 활발한 구인자
- **특징**: +10% 보너스
- **마케팅**: "스마트한 선택"

#### ₩50,000 패키지 (190💎)
- **타겟**: 다점포 운영자
- **특징**: +14% 보너스
- **마케팅**: "대량 할인"

#### ₩100,000 패키지 (400💎) 🔥 최대
- **타겟**: 대형 체인점, 프랜차이즈
- **특징**: +20% 보너스 (최대 할인)
- **마케팅**: "최대 할인 패키지"

---

## 💖 하트 획득 방법

### 획득 이벤트 정의

| 이벤트 | 보상 | 주기 | 조건 |
|--------|------|------|------|
| 첫 가입 | +10💖 | 1회 | 회원가입 완료 |
| 출석 체크 | +1💖 | 매일 | 앱 접속 시 버튼 클릭 |
| 7일 연속 출석 | +3💖 | 주간 | 7일 연속 출석 달성 |
| 근무 완료 리뷰 | +1💖 | 건당 | 근무 후 리뷰 작성 |
| 친구 초대 | +5💖 | 건당 | 초대 코드로 가입 시 |

### 하트 배치 관리

```typescript
// 하트는 배치 단위로 관리 (만료 추적 최적화)
interface HeartBatch {
  id: string;
  userId: string;
  amount: number;           // 남은 수량
  originalAmount: number;   // 초기 발급량
  expiresAt: Timestamp;     // 만료일 (획득 + 90일)
  source: HeartSource;      // 획득 경로
  createdAt: Timestamp;
}

type HeartSource =
  | 'signup_bonus'    // 가입 보너스
  | 'attendance'      // 출석 체크
  | 'weekly_bonus'    // 7일 연속 출석
  | 'review'          // 근무 리뷰
  | 'referral'        // 친구 초대
  | 'event'           // 이벤트
  | 'admin_grant';    // 관리자 지급
```

### 사용 순서 알고리즘

```typescript
// 포인트 차감 시 우선순위
// 1. 하트 (만료 임박 순)
// 2. 다이아

async function deductPoints(
  userId: string,
  amount: number,
  reason: string
): Promise<DeductionResult> {
  return await runTransaction(db, async (transaction) => {
    let remaining = amount;
    const usedBatches: UsedBatch[] = [];

    // 1. 하트 배치 조회 (만료 임박 순)
    const heartBatches = await getHeartBatches(userId, transaction);

    for (const batch of heartBatches) {
      if (remaining <= 0) break;

      const useAmount = Math.min(batch.amount, remaining);
      usedBatches.push({ batchId: batch.id, amount: useAmount });
      remaining -= useAmount;

      // 배치 차감
      transaction.update(batchRef, {
        amount: batch.amount - useAmount
      });
    }

    // 2. 남은 금액은 다이아에서 차감
    if (remaining > 0) {
      const wallet = await getWallet(userId, transaction);
      if (wallet.diamondBalance < remaining) {
        throw new InsufficientBalanceError();
      }

      transaction.update(walletRef, {
        diamondBalance: wallet.diamondBalance - remaining
      });
    }

    // 3. 트랜잭션 기록
    await recordTransaction(transaction, {
      userId, amount, reason, usedBatches
    });

    return { success: true };
  });
}
```

---

## 📢 공고 등록 가격표

### 공고 타입별 가격

| 공고 타입 | 포인트 | 원화 환산 | 기간 | 특징 |
|----------|--------|----------|------|------|
| regular (일반) | 1💎 | ₩300 | 7일 | 기본 공고 |
| urgent (긴급) | 10💎 | ₩3,000 | 7일 | 긴급탭 노출, 우선 표시 |
| fixed (고정) | 5💎 | ₩1,500 | 30일 | 장기 공고 |
| tournament (대회) | 협의 | - | 대회 기간 | 관리자 승인 필요 |

### 추가 옵션

| 옵션 | 포인트 | 원화 환산 | 효과 |
|------|--------|----------|------|
| 기간 연장 | 1💎 | ₩300 | +7일 연장 |
| 긴급 전환 | 10💎 | ₩3,000 | 긴급탭으로 이동 |
| 상단 노출 | 3💎 | ₩900 | 24시간 상단 고정 |
| 푸시 알림 | 5💎 | ₩1,500 | 지원자에게 알림 발송 |

---

## 🛡️ 어뷰징 방지 시스템

### 1차 방어선: 인증 시스템

#### 전화번호 인증 (필수)
```yaml
절차:
  1. 전화번호 입력 (010-XXXX-XXXX)
  2. SMS 인증 코드 발송 (6자리)
  3. 3분 내 인증 완료
  4. 인증 완료 시 첫 가입 하트 10개 지급

제한:
  - VoIP 번호 차단 (070, 050)
  - 해외 번호 차단
  - 1일 동일 번호 인증 시도 5회 제한
```

### 2차 방어선: 중복 계정 탐지

```yaml
모니터링 항목:
  IP 주소:
    - 동일 IP에서 24시간 내 3개 이상 계정 생성 → 플래그
    - VPN/프록시 사용 감지

  기기:
    - 디바이스 핑거프린트 수집
    - 동일 기기에서 다중 계정 탐지

  행동 패턴:
    - 가입 → 하트 수령 → 즉시 사용 → 계정 방치 패턴
    - 비정상적 빠른 활동 (봇 의심)

조치:
  1단계: 추가 본인 인증 요구
  2단계: 계정 일시 정지 (7일)
  3단계: 영구 정지 + IP/기기 블랙리스트
```

### 3차 방어선: 환불 악용 방지

```yaml
환불 정책:
  - 다이아만 환불 가능 (하트 환불 불가)
  - 미사용 다이아만 환불
  - 구매 후 7일 이내

환불 제한:
  - 월 1회 환불 가능
  - 연 3회 환불 제한
  - 3회 초과 시 환불 불가 계정

악용 감지:
  - 충전 → 사용 → 환불 반복 패턴
  - 환불 직후 재구매 패턴
```

---

## ⚖️ 법률 리스크 최소화

### 약관 핵심 내용

#### 제1조: 포인트의 정의

```
하트(Heart)와 다이아(Diamond)는 UNIQN 플랫폼 내
서비스 이용을 위한 전자적 수단입니다.
「전자상거래법」상 서비스 이용권에 해당하며,
현금, 재화, 경제적 가치로 환전 불가합니다.
```

#### 제2조: 하트 정책

```yaml
획득:
  - 출석, 리뷰, 초대 등 무료 이벤트로 획득
  - 관리자 지급 가능

만료:
  - 획득 후 90일 자동 소멸
  - 만료 7일 전 알림 발송

환불:
  - 환불 불가 (무료 획득이므로)

사용 순서:
  - 다이아보다 먼저 사용됨 (만료 임박 순)
```

#### 제3조: 다이아 정책

```yaml
구매:
  - 만 19세 이상만 구매 가능
  - 전화번호 인증 필수
  - RevenueCat(앱스토어) 통해 결제

만료:
  - 없음 (영구 보유)

환불:
  - 미사용분에 한해 7일 이내 환불 가능
  - 월 1회, 연 3회 제한

양도:
  - 타인에게 양도, 판매, 증여 금지
```

#### 제4조: 서비스 종료 시

```yaml
사전 고지:
  - 서비스 종료 90일 전 공지
  - 이메일, 앱 푸시, SMS 다중 안내

환불 대상:
  - 다이아: 미사용분 100% 현금 환불
  - 하트: 환불 대상 제외 (무료 획득)
  - 이벤트/프로모션 지급분: 환불 제외

환불 절차:
  - 서비스 종료일로부터 30일 이내 처리
  - 앱스토어 환불 정책 준수
```

---

## 📢 만료 알림 시스템

### 알림 스케줄 (하트 기준)

| 시점 | 발송 수단 | 메시지 톤 | 우선순위 |
|------|----------|----------|---------|
| 7일 전 | 앱 푸시 | 안내 | 보통 |
| 3일 전 | 앱 푸시 + 인앱 배너 | 주의 | 높음 |
| 당일 | 앱 푸시 + 인앱 모달 | 긴급 | 최고 |

### 알림 메시지 예시

#### 7일 전
```
💖 하트 만료 알림
3개의 하트가 7일 후 만료됩니다.
지금 공고를 등록해보세요!
[공고 등록하기]
```

#### 3일 전
```
⚠️ 하트 만료 임박!
3개의 하트가 3일 후 소멸됩니다.
사용하지 않으면 사라집니다!
[지금 사용하기]
```

#### 당일
```
🚨 오늘 하트 소멸!
3개의 하트가 오늘 자정에 완전히 사라집니다!
마지막 기회입니다!
[긴급 사용하기]
```

---

## 🎯 핵심 장점 요약

### 1. 직관성 향상

- **단순한 가치**: 1 포인트 = 300원
- **명확한 구분**: 하트(무료) vs 다이아(유료)
- **시각적 구분**: 💖 핑크 vs 💎 퍼플

### 2. 낮은 진입 장벽

- ₩1,000부터 충전 가능
- 첫 가입 시 하트 10개 제공
- 6개월 무료 기간

### 3. 사용자 유지

- 출석 체크로 일일 방문 유도
- 하트 만료 알림으로 사용 독려
- 리뷰/초대 보상으로 바이럴 효과

### 4. 확장성

- RevenueCat으로 iOS/Android 통합 결제
- Feature Flag로 점진적 유료화
- B2B 패키지로 대형 고객 공략

### 5. 법적 안정성

- 명확한 약관 (서비스 이용권)
- 환불 정책 투명화
- 미성년자 보호 (19세 이상)

---

## 📋 구현 우선순위

### Phase 1: 기반 구축 (1주)

```yaml
Day 1-2:
  - [ ] 타입 정의 (wallet.ts, point.ts)
  - [ ] Zod 스키마 작성
  - [ ] 에러 클래스 추가 (WalletErrors.ts)

Day 3-4:
  - [ ] Firestore 컬렉션 설계
  - [ ] Security Rules 작성
  - [ ] 인덱스 설정

Day 5:
  - [ ] Repository 패턴 구현
  - [ ] walletService, pointService 작성
```

### Phase 2: 핵심 기능 (1주)

```yaml
Day 1-2:
  - [ ] walletStore (Zustand) 구현
  - [ ] useWallet, useAttendance 훅

Day 3-4:
  - [ ] WalletBalance UI 컴포넌트
  - [ ] PointHistory UI 컴포넌트
  - [ ] AttendanceButton UI 컴포넌트

Day 5:
  - [ ] 공고 생성 시 포인트 연동
  - [ ] Cloud Functions (회원가입 보너스)
```

### Phase 3: 결제 시스템 (1주)

```yaml
Day 1-2:
  - [ ] RevenueCat 연동 (Provider 추상화)
  - [ ] 상품 등록 (앱스토어)

Day 3-4:
  - [ ] DiamondPurchaseModal UI
  - [ ] 결제 완료 Webhook (Cloud Functions)

Day 5:
  - [ ] Sandbox 테스트
  - [ ] 에러 처리 및 복구
```

### Phase 4: 부가 기능 (1주)

```yaml
Day 1-2:
  - [ ] 하트 만료 알림 (Cloud Functions)
  - [ ] InAppMessageManager 연동

Day 3-4:
  - [ ] 친구 초대 보상
  - [ ] 근무 리뷰 보상

Day 5:
  - [ ] 관리자 기능 (포인트 지급)
  - [ ] 환불 처리
```

---

## 📚 관련 문서

- [mobile-payment-plan.md](../../../mobile-payment-plan.md) - 상세 구현 계획
- [REVENUE_MODEL_ANALYSIS.md](./REVENUE_MODEL_ANALYSIS.md) - 수익 모델 분석
- [CHIP_SYSTEM_IMPLEMENTATION_GUIDE.md](./CHIP_SYSTEM_IMPLEMENTATION_GUIDE.md) - 구현 가이드
- [PAYMENT_SYSTEM_DEVELOPMENT.md](./PAYMENT_SYSTEM_DEVELOPMENT.md) - 개발 문서

---

**UNIQN 하트/다이아 포인트 시스템은 단순하고 직관적이며,
사용자 친화적인 결제 경험을 제공합니다. 💎**

---

*마지막 업데이트: 2025-02-01*
*버전: v2.0.0*
